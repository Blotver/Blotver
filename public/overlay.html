<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Overlay</title>
    <script src="/socket.io/socket.io.js"></script>

    <style>
        body {
            margin: 0;
            background: transparent;
            overflow: hidden;
        }

        #clip {
            position: absolute;
            width: 600px;
            height: 340px;
            border-radius: 16px;
            overflow: hidden;
            display: none;
        }

        video {
            width: 100%;
            height: 100%;
            border-radius: 16px;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <div id="clipContainer"></div>

<script>
const projectId = window.location.pathname.split("/").pop();
const socket = io();
const container = document.getElementById("clipContainer");

let playing = false;

socket.emit("joinProject", projectId);

socket.on("newClip", (data) => {

    if (playing) return;

    playing = true;

    container.innerHTML = `
        <video id="clipVideo" autoplay>
            <source src="/api/clip-proxy?url=${encodeURIComponent(data.videoUrl)}" type="video/mp4">
        </video>
    `;

    const video = document.getElementById("clipVideo");

    video.onended = reset;
    setTimeout(reset, (data.duration * 1000) || 15000);
});

function reset() {
    container.innerHTML = "";
    playing = false;
}
</script>
</body>

</html>